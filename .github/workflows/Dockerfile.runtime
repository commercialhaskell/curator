FROM ghcr.io/commercialhaskell/curator/base-build:commit-9e621eb31fddbd9590d9c8b84ed09c68c1cce337 as build-app

RUN mkdir -p /artifacts/bin
COPY . /src
RUN stack install --stack-yaml /src/stack.yaml --local-bin-path /artifacts/bin

FROM ghcr.io/commercialhaskell/curator/base-run:commit-9e621eb31fddbd9590d9c8b84ed09c68c1cce337

RUN mkdir -p /app/db
COPY --from=build-app /artifacts/bin/casa-curator /usr/local/bin/casa-curator
COPY --from=build-app /artifacts/bin/curator /usr/local/bin/curator
